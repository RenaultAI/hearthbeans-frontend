<!DOCTYPE HTML>
<html>
  <body>
    <script src="https://static.opentok.com/v2/js/opentok.js" charset="utf-8"></script>
	<script charset="utf-8">
	  OT.registerScreenSharingExtension('chrome', 'hpakhcgaiddliigdmifkghikcfoihcfd', 2);
      var apiKey = '45793372';
      var sessionId = '1_MX40NTc5MzM3Mn5-MTQ4OTI2MTE1OTc4NX5JdHBZTVpXbVJkT3g1bW55Y0MzR3VYR1N-fg';
      var token = 'T1==cGFydG5lcl9pZD00NTc5MzM3MiZzaWc9OWRiNTc1MTdkNzA5NDA1YmQzMGJkZDM5MjgzZTY0YTA3M2VhMDExMjpzZXNzaW9uX2lkPTFfTVg0ME5UYzVNek0zTW41LU1UUTRPVEkyTVRFMU9UYzROWDVKZEhCWlRWcFhiVkprVDNnMWJXNTVZME16UjNWWVIxTi1mZyZjcmVhdGVfdGltZT0xNDg5MjYxMTg0Jm5vbmNlPTAuOTU5MjkxOTUyNjUxNzY1NiZyb2xlPXB1Ymxpc2hlciZleHBpcmVfdGltZT0xNDkxODQ5NTgz';
      var publisher;
	  function shareScreen() {
		var session = OT.initSession(apiKey, sessionId)
			// .on('streamCreated', function(event) {
			// 	console.log('subscribing');
			// 	window.subscriber = session.subscribe(event.stream, null, null, function () {
			// 		console.log('!!!!!!!!!!!!!!!!!!!!!!!!!!!!');
			// 		var imgString = subscriber.getImgData();
			// 	});
			// })
			.connect(token, function(error) {
			publisher = OT.initPublisher(null, {videoSource: 'screen'});
			// session.publish(publisher);

			});
	  }

	  var stopIntervalId;
	  function startImageCapture() {
		  var counter = 0;
			stopIntervalId = setInterval(function() {
				var imgData = publisher.getImgData();
				var img = document.createElement("img");
				img.setAttribute("src", "data:image/png;base64," + imgData);
				img.setAttribute("id", "screenshot_" + counter);
				img.setAttribute("width", "100px");

				// var imgWin = window.open("about:blank", "Screenshot");
				// imgWin.document.write("<body></body>");
				window.document.body.appendChild(img);
				counter ++;
			}, 3000);
	  }

	  function stopImageCapture() {
		  clearInterval(stopIntervalId);
	  }

    </script>
	<input type="button" onclick="shareScreen()" value="Start streaming"/>
	<input type="button" onclick="startImageCapture()" value="Start adding screenshots"/>
	<input type="button" onclick="stopImageCapture()" value="stop adding screenshots"/>


  </body>
</html>